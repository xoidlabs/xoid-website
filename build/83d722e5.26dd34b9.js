(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{81:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return p})),n.d(t,"default",(function(){return f}));var r=n(2),a=n(6),o=(n(0),n(93)),c=["components"],s={id:"refactoring-react-classes",title:"Refactoring React classes"},i={unversionedId:"recipes-react/refactoring-react-classes",id:"recipes-react/refactoring-react-classes",isDocsHomePage:!1,title:"Refactoring React classes",description:"xoid can provide a scaffolding system for refactoring React class components into function components. During refactoring, intermediate version of the component keeps working.",source:"@site/main/docs/recipes-react/refactoring-react-classes.md",slug:"/recipes-react/refactoring-react-classes",permalink:"/docs/recipes-react/refactoring-react-classes",editUrl:"https://github.com/xoidlabs/xoid/blob/main/docs/recipes-react/refactoring-react-classes.md",version:"current",sidebar:"docs",previous:{title:"Dynamic functions with fixed references",permalink:"/docs/recipes-react/dynamic-functions-with-fixed-references"},next:{title:"Grabbing refs",permalink:"/docs/recipes-react/grabbing-refs"}},p=[],l={rightToc:p},u="wrapper";function f(e){var t=e.components,n=Object(a.a)(e,c);return Object(o.b)(u,Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"xoid")," can provide a scaffolding system for refactoring React class components into function components. During refactoring, intermediate version of the component keeps working. "),Object(o.b)("p",null,"Let's imagine that the following class component is going to be refactored:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"class App extends React.Component {\n  // state\n  state = { alpha: 5 }\n  // methods\n  incrementAlpha = () => {\n    this.setState({ alpha: this.state.alpha + 1 })\n  }\n  render() {\n    // render\n    return <div onClick={this.incrementAlpha}>{this.state.alpha}</div> \n  }\n}\n")),Object(o.b)("p",null,"Here's a basic React-like class component runtime prepared with ",Object(o.b)("strong",{parentName:"p"},"xoid"),"."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { create, Atom } from 'xoid'\n\nclass Runtime<Props, State> {\n  $props: Atom<Props>;\n  $state!: Atom<State>;\n  constructor($props: Atom<Props>) {\n    this.$props = $props;\n  }\n  get props() {\n    return this.$props.value;\n  }\n  get state() {\n    return this.$state.value;\n  }\n  setState(partial: Partial<State>) {\n    this.$state.update((s) => ({ ...s, ...partial }));\n  }\n}\n")),Object(o.b)("p",null,"We can then easily evolve into the following, working structure without too much refactor:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"class AppRuntime extends Runtime<{}, { alpha: number }> {\n  $state = create({ alpha: 5 });\n  incrementAlpha = () => {\n    this.setState({ alpha: this.state.alpha + 1 });\n  };\n}\n\nconst App = (props: Props) => {\n  const self = useSetup(($props) => new AppRuntime($props), props)\n  useAtom(self.$state)\n\n  return <div onClick={self.incrementAlpha}>{self.state.alpha}</div>\n}\n")),Object(o.b)("p",null,"Observe that the only big differece is replacing ",Object(o.b)("inlineCode",{parentName:"p"},"this")," in the render function with ",Object(o.b)("inlineCode",{parentName:"p"},"self"),"."),Object(o.b)("p",null,"After getting rid of ",Object(o.b)("inlineCode",{parentName:"p"},"this.setState")," usages, we can get rid of the ",Object(o.b)("inlineCode",{parentName:"p"},"Runtime")," class too."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"const AppSetup = ($props: Atom<Props>) => {\n  const $state = create({ alpha: 5 })\n  const incrementAlpha = () => $state.focus('alpha').update((s) => s + 1)\n  return { $state, incrementAlpha }\n}\n\nconst App = (props: Props) => {\n  const { $state, incrementAlpha } = useSetup(AppSetup, props)\n  const { alpha } = useAtom(self.$state)\n\n  return <div onClick={self.incrementAlpha}>{alpha}</div>\n}\n")))}f.isMDXComponent=!0},93:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),l=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=l(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},f="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=l(n),f=r,b=u["".concat(c,".").concat(f)]||u[f]||m[f]||o;return n?a.a.createElement(b,s(s({ref:t},p),{},{components:n})):a.a.createElement(b,s({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,c=new Array(o);c[0]=b;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[f]="string"==typeof e?e:r,c[1]=s;for(var p=2;p<o;p++)c[p]=n[p];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);